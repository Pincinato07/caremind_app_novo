# Regras e Guia do Cursor - CareMind App (Flutter)

## ğŸ“‹ VisÃ£o Geral do Projeto

O CareMind App Ã© um aplicativo Flutter para cuidado e acompanhamento de saÃºde de idosos, com:
- **Framework**: Flutter 3.5+
- **Linguagem**: Dart
- **State Management**: Riverpod 2.4+
- **Backend**: Supabase
- **NotificaÃ§Ãµes**: Firebase Cloud Messaging (FCM)
- **NavegaÃ§Ã£o**: GoRouter

## ğŸ—ï¸ Estrutura do Projeto

```
lib/
â”œâ”€â”€ main.dart                    # Ponto de entrada
â”œâ”€â”€ core/                       # Funcionalidades core
â”‚   â”œâ”€â”€ accessibility/         # Acessibilidade
â”‚   â”œâ”€â”€ deep_link/            # Deep links
â”‚   â”œâ”€â”€ errors/               # Tratamento de erros
â”‚   â”œâ”€â”€ injection/            # InjeÃ§Ã£o de dependÃªncias (GetIt)
â”‚   â”œâ”€â”€ navigation/           # ConfiguraÃ§Ã£o de navegaÃ§Ã£o
â”‚   â””â”€â”€ services/             # ServiÃ§os base
â”œâ”€â”€ models/                    # Modelos de dados
â”œâ”€â”€ providers/                 # Riverpod providers
â”œâ”€â”€ screens/                   # Telas do app
â”‚   â”œâ”€â”€ auth/                 # AutenticaÃ§Ã£o
â”‚   â”œâ”€â”€ individual/           # Perfil individual
â”‚   â”œâ”€â”€ familiar/             # Perfil familiar
â”‚   â”œâ”€â”€ idoso/                # Perfil idoso
â”‚   â”œâ”€â”€ organizacao/          # OrganizaÃ§Ãµes
â”‚   â”œâ”€â”€ medication/           # Medicamentos
â”‚   â”œâ”€â”€ rotinas/              # Rotinas
â”‚   â”œâ”€â”€ compromissos/         # Compromissos
â”‚   â””â”€â”€ shared/               # Telas compartilhadas
â”œâ”€â”€ services/                  # ServiÃ§os de negÃ³cio
â”œâ”€â”€ theme/                     # Tema do app
â””â”€â”€ widgets/                   # Widgets reutilizÃ¡veis
```

## ğŸ“ ConvenÃ§Ãµes de CÃ³digo

### Nomenclatura
- **Classes**: PascalCase (`UserProfileScreen`)
- **Arquivos**: snake_case (`user_profile_screen.dart`)
- **VariÃ¡veis/FunÃ§Ãµes**: camelCase (`getUserData`)
- **Constantes**: camelCase com prefixo `k` ou `const` em UPPER_CASE
- **Privados**: Prefixo `_` (`_privateMethod`)

### Estrutura de Arquivos
```dart
// 1. Imports (Flutter primeiro, depois packages, depois relativos)
import 'package:flutter/material.dart';
import 'package:supabase_flutter/supabase_flutter.dart';
import '../models/user.dart';

// 2. Classe principal
class UserProfileScreen extends ConsumerWidget {
  const UserProfileScreen({super.key});
  
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // implementaÃ§Ã£o
  }
}
```

### Widgets
- Prefira `StatelessWidget` ou `ConsumerWidget` (Riverpod)
- Use `const` quando possÃ­vel
- Extraia widgets grandes em mÃ©todos privados ou classes separadas
- Use `super.key` em construtores

### State Management (Riverpod)
- Use `ConsumerWidget` para widgets que precisam de providers
- Use `ref.watch()` para ler e observar mudanÃ§as
- Use `ref.read()` para aÃ§Ãµes Ãºnicas (nÃ£o observar)
- Use `ref.listen()` para side effects

```dart
// Exemplo de uso do Riverpod
class MyWidget extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final user = ref.watch(userProvider);
    final isLoading = ref.watch(loadingProvider);
    
    return Scaffold(
      body: isLoading 
        ? CircularProgressIndicator()
        : Text(user.name),
    );
  }
}
```

### Models
- Use classes com construtores nomeados
- Implemente `fromJson` e `toJson` quando necessÃ¡rio
- Use `equatable` para comparaÃ§Ã£o de objetos
- Documente campos importantes

### Services
- Uma classe por serviÃ§o
- Use injeÃ§Ã£o de dependÃªncias (GetIt)
- Sempre trate erros adequadamente
- Use async/await, nÃ£o `.then()`

```dart
// Exemplo de service
class UserService {
  final SupabaseClient _supabase;
  
  UserService(this._supabase);
  
  Future<User> getUser(String id) async {
    try {
      final response = await _supabase
        .from('users')
        .select()
        .eq('id', id)
        .single();
      
      return User.fromJson(response);
    } catch (e) {
      throw UserServiceException('Erro ao buscar usuÃ¡rio: $e');
    }
  }
}
```

## ğŸ¨ UI e Design

### Tema
- Use `AppTheme` para cores, textos e espaÃ§amentos
- Sempre use `AppColors`, `AppTextStyles`, `AppSpacing`
- Mantenha consistÃªncia visual

### Widgets ReutilizÃ¡veis
- Crie widgets em `lib/widgets/` quando reutilizÃ¡veis
- Use composiÃ§Ã£o ao invÃ©s de heranÃ§a
- Documente props importantes

### Responsividade
- Use `MediaQuery` para tamanhos de tela
- Teste em diferentes dispositivos
- Considere tablets e landscape quando necessÃ¡rio

## ğŸ” AutenticaÃ§Ã£o e SeguranÃ§a

### Supabase
- Use `Supabase.instance.client` para acessar o cliente
- Sempre verifique autenticaÃ§Ã£o antes de operaÃ§Ãµes sensÃ­veis
- Use RLS do Supabase (nÃ£o bypass)

### Dados SensÃ­veis
- Use `flutter_secure_storage` para tokens
- Nunca hardcode secrets
- Use `.env` para configuraÃ§Ãµes (flutter_dotenv)

## ğŸ“± NavegaÃ§Ã£o

### GoRouter
- Configure rotas em `core/navigation/`
- Use named routes
- Passe parÃ¢metros via `extra` ou query params
- Use `context.go()` para navegaÃ§Ã£o

### Deep Links
- Use `DeepLinkHandler` para processar deep links
- Configure URLs no `AndroidManifest.xml` e `Info.plist`

## ğŸ”” NotificaÃ§Ãµes

### Firebase Cloud Messaging
- Use `NotificationService` para gerenciar notificaÃ§Ãµes
- Configure handlers para foreground e background
- Atualize token FCM quando necessÃ¡rio

## ğŸ’¾ Armazenamento Local

### SharedPreferences
- Use para configuraÃ§Ãµes simples
- NÃ£o use para dados sensÃ­veis

### Secure Storage
- Use para tokens e dados sensÃ­veis
- Sempre trate erros de acesso

### Hive
- Use para cache de dados
- Configure boxes apropriadamente

## ğŸ§ª Testes e Qualidade

### Linting
- Use `dart analyze` antes de commitar
- Corrija todos os warnings
- Use `dart format .` para formataÃ§Ã£o

### Type Safety
- Sempre use tipos explÃ­citos
- Evite `dynamic` - use `Object?` se necessÃ¡rio
- Use null safety adequadamente

## ğŸš€ Build e Deploy

### Android
- Configure `android/app/build.gradle`
- Use `key.properties` para signing
- Configure `google-services.json` para Firebase

### iOS
- Configure `ios/Runner/Info.plist`
- Configure `GoogleService-Info.plist` para Firebase
- Configure signing no Xcode

### VariÃ¡veis de Ambiente
- Use `.env` para configuraÃ§Ãµes
- Configure no CI/CD para produÃ§Ã£o
- Nunca commite `.env` files

## ğŸ“š Bibliotecas Principais

- **flutter_riverpod**: State management
- **supabase_flutter**: Backend e auth
- **go_router**: NavegaÃ§Ã£o
- **firebase_messaging**: NotificaÃ§Ãµes push
- **cached_network_image**: Imagens
- **intl**: InternacionalizaÃ§Ã£o
- **url_launcher**: Abrir URLs externas

## ğŸ”„ PadrÃµes de Commit

Use Conventional Commits em portuguÃªs:

Formato: `tipo(escopo): descriÃ§Ã£o`

Tipos:
- `feat`: Nova funcionalidade
- `fix`: CorreÃ§Ã£o de bug
- `docs`: DocumentaÃ§Ã£o
- `style`: FormataÃ§Ã£o
- `refactor`: RefatoraÃ§Ã£o
- `perf`: Performance
- `test`: Testes
- `chore`: ManutenÃ§Ã£o

Exemplos:
- `feat(auth): adiciona login com Google`
- `fix(dashboard): corrige carregamento de dados`
- `refactor(services): reorganiza estrutura de serviÃ§os`

## âš ï¸ Avisos Importantes

1. **Async/Await**: Sempre use, nunca `.then()` chains
2. **Error Handling**: Sempre trate erros adequadamente
3. **Memory Leaks**: Dispose controllers e subscriptions
4. **Performance**: Use `const` quando possÃ­vel, evite rebuilds desnecessÃ¡rios
5. **Acessibilidade**: Sempre considere acessibilidade (semantics)

## ğŸ¯ PadrÃµes EspecÃ­ficos do Projeto

### Providers
- Crie providers em `lib/providers/`
- Use `@riverpod` annotations quando possÃ­vel
- Documente providers complexos

### Screens
- Uma screen por arquivo
- Use `ConsumerWidget` quando precisar de providers
- Extraia lÃ³gica complexa para services

### Services
- Uma responsabilidade por service
- Use GetIt para injeÃ§Ã£o de dependÃªncias
- Sempre retorne tipos especÃ­ficos, nÃ£o `dynamic`

### Models
- Use `fromJson` e `toJson` para serializaÃ§Ã£o
- Implemente `toString()` para debug
- Use `copyWith` quando apropriado

## ğŸ›ï¸ Arquitetura

### Camadas da AplicaÃ§Ã£o
1. **Presentation Layer**: `lib/screens/`, `lib/widgets/` - UI e widgets
2. **Business Logic Layer**: `lib/providers/` - LÃ³gica de negÃ³cio (Riverpod)
3. **Data Access Layer**: `lib/services/` - ComunicaÃ§Ã£o com backend
4. **Domain Layer**: `lib/models/` - Modelos de dados
5. **Infrastructure Layer**: `lib/core/` - ServiÃ§os base (DI, Navigation, etc)

### Fluxo de Dados
```
User Action â†’ Widget â†’ Provider â†’ Service â†’ Supabase Backend
```

### State Management (Riverpod)
- **Providers**: Estado global e lÃ³gica de negÃ³cio
- **Watch**: Observar mudanÃ§as (`ref.watch()`)
- **Read**: AÃ§Ãµes Ãºnicas (`ref.read()`)
- **Listen**: Side effects (`ref.listen()`)

### InjeÃ§Ã£o de DependÃªncias
- **GetIt**: Registrado em `core/injection/injection.dart`
- Use `getIt<ServiceType>()` para obter instÃ¢ncias
- Services sÃ£o singletons ou factories conforme necessÃ¡rio

## ğŸ”„ Fluxos Comuns de Desenvolvimento

### Adicionar Nova Feature
1. Criar screen em `lib/screens/[categoria]/`
2. Criar models em `lib/models/` se necessÃ¡rio
3. Criar services em `lib/services/` se necessÃ¡rio
4. Criar providers em `lib/providers/` se necessÃ¡rio
5. Adicionar rota em `core/navigation/`
6. Testar fluxo completo

### Criar Nova Screen
1. LocalizaÃ§Ã£o: `lib/screens/[categoria]/screen_name_screen.dart`
2. Use `ConsumerWidget` se precisar de providers
3. Extraia widgets grandes em classes privadas ou mÃ©todos
4. Use `AppTheme` para cores, textos e espaÃ§amentos
5. Trate estados de loading e erro

### Criar Novo Provider
1. LocalizaÃ§Ã£o: `lib/providers/provider_name_provider.dart`
2. Use `@riverpod` annotations quando possÃ­vel
3. Use `@riverpod` class para providers com estado mutÃ¡vel
4. Use `@riverpod` Future/Stream para dados assÃ­ncronos
5. Execute `dart run build_runner build` apÃ³s criar

### Criar Novo Service
1. LocalizaÃ§Ã£o: `lib/services/service_name_service.dart`
2. Registre no GetIt em `core/injection/injection.dart`
3. Use `Supabase.instance.client` para queries
4. Sempre trate erros adequadamente
5. Retorne tipos especÃ­ficos, nÃ£o `dynamic`

### Trabalhar com Supabase
```dart
final supabase = Supabase.instance.client;

// Select
final { data, error } = await supabase
  .from('table')
  .select()
  .eq('column', value);

// Insert
final { data, error } = await supabase
  .from('table')
  .insert({ 'column': value });

// Update
final { error } = await supabase
  .from('table')
  .update({ 'column': value })
  .eq('id', id);

// Delete
final { error } = await supabase
  .from('table')
  .delete()
  .eq('id', id);
```

### Adicionar NavegaÃ§Ã£o
1. Adicionar rota em `core/navigation/router.dart`
2. Usar `context.go('/route')` para navegaÃ§Ã£o
3. Passar parÃ¢metros via `extra` se necessÃ¡rio
4. Configurar deep links se aplicÃ¡vel

### Adicionar NotificaÃ§Ã£o
1. Usar `NotificationService` para gerenciar
2. Configurar handlers em `main.dart`
3. Atualizar FCM token quando necessÃ¡rio
4. Testar em dispositivo real

## ğŸ› Troubleshooting Comum

### Erros Frequentes
- **"Provider not found"**: Verificar se provider estÃ¡ registrado e widget Ã© `ConsumerWidget`
- **"Supabase error"**: Verificar variÃ¡veis de ambiente, RLS policies e conexÃ£o
- **"Build fails"**: Limpar build (`flutter clean`), atualizar dependÃªncias (`flutter pub get`)
- **"Riverpod not working"**: Verificar se `ProviderScope` estÃ¡ no root, se widget Ã© `ConsumerWidget`

### Comandos Ãšteis
```bash
# Formatar cÃ³digo
dart format .

# Analisar cÃ³digo
dart analyze

# Limpar build
flutter clean
flutter pub get

# Rodar app
flutter run

# Gerar cÃ³digo Riverpod
dart run build_runner build --delete-conflicting-outputs

# Build release Android
flutter build apk --release

# Build release iOS
flutter build ios --release
```

## ğŸ¨ Design System

### Cores
Sempre use `AppColors` do tema:
- `AppColors.primary`
- `AppColors.secondary`
- `AppColors.error`
- `AppColors.success`
- `AppColors.textPrimary`
- `AppColors.textSecondary`

### Textos
Sempre use `AppTextStyles`:
- `AppTextStyles.headlineLarge`
- `AppTextStyles.bodyMedium`
- `AppTextStyles.titleSmall`

### EspaÃ§amentos
Sempre use `AppSpacing`:
- `AppSpacing.small`
- `AppSpacing.medium`
- `AppSpacing.large`
- `AppSpacing.xlarge`

## ğŸ†˜ Quando Precisar de Ajuda

1. Consulte a documentaÃ§Ã£o do Flutter
2. Veja exemplos em `lib/screens/` e `lib/widgets/`
3. Verifique `docs/` para documentaÃ§Ã£o especÃ­fica
4. Use autocomplete do IDE para descobrir APIs
5. Consulte `CURSOR_GUIDE.md` e `ARCHITECTURE.md` para detalhes completos

